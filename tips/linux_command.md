## grep

使用 `grep` 匹配 `X-device=` 后面所有字符，直到遇到 `|` 符号。以下是具体的命令：

```sh
grep -oP 'X-device=[^|]*' your_log_file.log
```

这个命令的解释如下：
- `grep`：搜索文本文件中与正则表达式匹配的行。
- `-o`：只输出匹配的部分。
- `-P`：使用 Perl 兼容正则表达式。
- `'X-device=[^|]*'`：正则表达式模式，其中：
  - `X-device=`：匹配固定的字符串 `X-device=`。
  - `[^|]*`：匹配除 `|` 以外的任意字符，零次或多次。
 
提取日志文件中 `uin=1234` 的数值部分。以下是一个示例命令：

```sh
grep -oP 'uin=\K\d+' your_log_file.log
```

这个命令的重点是 \K 这个标记

命令的解释如下：
- `grep -oP 'uin=\K\d+' your_log_file.log`：
  - `grep` 是一个搜索工具。
  - `-o` 选项表示只输出匹配的部分。
  - `-P` 选项启用 Perl 兼容正则表达式（PCRE）。
  - `'uin=\K\d+'` 是正则表达式：
    - `uin=` 匹配固定字符串 `uin=`。
    - `\K` 表示重置匹配起始位置，不包括之前的部分。
    - `\d+` 匹配一个或多个数字。


## ps

### 统计所有同一程序的所有进程的内存占用

```shell
ps -eo rss,cmd | grep php | grep -v grep | awk '{ sum+=$1 } END { print sum/1024 " MB" }'
```

这里是各部分的解释：

1. `ps -eo rss,cmd`: 列出所有进程的Resident Set Size (RSS，即常驻内存集大小)和命令。RSS值以kilobytes为单位。

2. `grep php`: 从`ps`输出中筛选出与PHP相关的进程。

3. `grep -v grep`: 过滤grep命令自身。

4. `awk '{ sum+=$1 } END { print sum/1024 " MB" }'`: 使用awk来计算所有PHP进程的总RSS。它将每个PHP进程的RSS值加到`sum`中，最后将总和除以1024来转换为MB，并打印出来。

执行此命令将显示所有PHP进程的总内存占用，以MB为单位。

## find

### 找出特定日期范围的文件

你可以使用 `find` 命令的 `-newermt` 选项来找出在指定日期范围内的文件。这个选项可以找出在给定日期之后修改的文件。然后，你可以使用 `! -newermt` 来找出在给定日期之前修改的文件。这样，你就可以找出在两个日期之间修改的文件。

例如，以下命令会找出在 2023-01-01 到 2023-04-30 之间修改的文件：

```bash
find /path/to/search -type f -newermt 2023-01-01 ! -newermt 2023-04-30
```

你可以使用 `-exec` 选项来对找到的文件执行命令。例如，以下命令会将找到的文件移动到 "archive_202301-202304" 目录：

```bash
find /path/to/search -type f -newermt 2023-01-01 ! -newermt 2023-04-30 -exec mv {} /path/to/archive_202301-202304 \;
```

注意：在这些命令中，你需要将 `/path/to/search` 和 `/path/to/archive_202301-202304` 替换为你实际的搜索路径和目标目录路径。这些命令可能需要相应的权限才能正确执行，你可能需要使用 `sudo`。

另外，请注意，在使用这些命令之前，最好先进行测试以确保它们的行为符合你的期望，特别是在使用 `-exec mv` 选项的时候，因为这可能会覆盖目标目录中的同名文件。

### 找出大小大于 1GB 的文件，然后清空它

你可以使用 `find` 命令配合 `-size` 选项查找出大于1GB的文件，然后使用 `-exec` 选项执行清空操作。下面是示例命令：

```bash
find /path/to/search -type f -size +1G -exec truncate --size 0 {} \;
```

解释:

- `/path/to/search`：你要搜索的目录，需要你根据实际情况替换。
- `-type f`：只查找文件。
- `-size +1G`：查找大于1GB的文件。
- `-exec truncate --size 0 {} \;`：对每一个找到的文件执行 `truncate --size 0` 命令，也就是将这些文件的大小清空。

请注意，这个命令会清空所有大于1GB的文件，不管这些文件是否还在使用中。在运行这个命令之前，请确保你明白这个命令的意义，如果有需要，先备份你的数据。

另外，`find` 命令可能需要 root 权限才能在整个系统中运行，如果没有足够的权限，你可能需要在命令前加上 `sudo`。


### 递归查找 /data/目录下最大的文件

使用以下命令可以递归地查找 `/data/` 目录下最大的文件：

```sh
find /data/ -type f -exec du -h {} + | sort -rh | head -n 1
```

`sort -rh` 命令用于按磁盘使用空间的大小对结果进行排序，`-r` 选项表示逆序排序，`-h` 选项表示按照人类可读的格式排序。

在这个上下文中，`+` 是 `find` 命令的 `-exec` 选项的一个参数，用于指示在命令行的结尾。

`-exec` 选项后面可以接一个命令，`find` 会将查找到的每个文件作为该命令的参数。`-exec` 选项后面的命令可以用 `{}` 来代替当前处理的文件名。

当 `-exec` 选项后面的命令用 `;` 结尾时，`find` 会为查找到的每个文件调用一次该命令。

当 `-exec` 选项后面的命令用 `+` 结尾时，`find` 会将查找到的所有文件作为该命令的参数，一次调用该命令。

因此，在本例中，`find /data/ -type f -exec du -h {} +` 的意思是：查找 `/data/` 目录下的所有文件，并将查找到的所有文件作为 `du -h` 命令的参数，一次调用 `du -h` 命令。
